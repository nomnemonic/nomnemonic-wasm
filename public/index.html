<html>
	<head>
		<meta charset="utf-8"/>
        <title>nomnemonic</title>
        <meta description="Generate deterministic mnemonics" />
		<script src="wasm_exec.js"></script>
        <style type="text/css">
            .info {
                width: 300px;
                display: inline-block;
                text-align: right;
            }
            .fixed-size {
                width: 20px;
                display: inline-block;
                text-align: right;
            }
            .success {
                color: green;
            }
            .failure {
                color: red;
            }
            .warning {
                color: orange;
            }
            #message {
                font-weight: bold;
            }
        </style>
		<script>
			const go = new Go();
			WebAssembly.instantiateStreaming(fetch("nomnemonic.wasm"), go.importObject).then((result) => {
				go.run(result.instance);
                document.getElementById("library_version").innerText = libraryVersion();
                document.getElementById("algorithm_version").innerText = algorithmVersion();
			});

            function generateAndFill() {
                document.getElementById("copy").hidden = true;
                document.getElementById("message").classList.remove("warning");
                document.getElementById("message").classList.remove("failure");
                document.getElementById("message").classList.remove("success");
                let sentence = generate(
                    document.getElementById("identifier").value,
                    document.getElementById("password").value,
                    document.getElementById("passcode").value,
                    document.getElementById("size").value,
                );
                if (sentence.match("Error:")) {
                    document.getElementById("message").innerText = sentence;
                    document.getElementById("message").classList.add("failure");
                    return;
                }

                document.getElementById("message").classList.add("success");
                document.getElementById("message").innerText = "Words are generated successfully!";

                createBoxes();

                let words = sentence.split(' ');
                for (var i = 0; i < words.length; i++) {
                    document.getElementById("word_"+(i+1)).value = words[i];
                }
                document.getElementById("copy").hidden = false;
            }

            function reset() {
                document.getElementById("identifier").value = "";
                document.getElementById("password").value = "";
                document.getElementById("passcode").value = "";
                document.getElementById("words").innerHTML = "";
                document.getElementById("message").innerHTML = "";
                document.getElementById("copy").hidden = true;

                document.getElementById("message").classList.remove("success");
                document.getElementById("message").classList.remove("failure");
                document.getElementById("message").classList.remove("warning");
            }

            function createBoxes() {
                let n = document.getElementById("size").value;
                let container = document.getElementById("words");
                container.innerHTML = "<h2>Words</h2>";

                for (var i = 0; i < n; i++) {
                    container.appendChild(createBox(i+1));
                }
            }

            function createBox(id) {
                let d = document.createElement("div");
                let html = `<span class="fixed-size">{{id}}.</span>
<input type="password" name="word" id="word_{{id}}" />
<a href="#word_{{id}}" onclick="toggle('word_{{id}}');">Show/Hide</a>`.replaceAll("{{id}}", id);
                d.innerHTML = html;
                return d;
            }

            function toggle(id) {
                let boxes = document.getElementsByName("word");
                for (var i = 0; i < boxes.length; i++) {
                    let box = boxes[i];
                    if (box.id === id) {
                        if (box.type === "password") {
                            box.type = "input";
                        } else {
                            box.type = "password";
                        }
                    } else {
                        box.type = "password";
                    }
                }
            }

            function toggleSingle(id) {
                let box = document.getElementById(id);
                if (box.type === "password") {
                    box.type = "input";
                } else {
                    box.type = "password";
                }
            }

            function copyWords() {
                var words = [];
                for (var i = 0; i < 24; i++) {
                    let elem = document.getElementById("word_" + (i+1))
                    if (elem === null) {
                        break;
                    }
                    words.push(elem.value);
                }
                navigator.clipboard.writeText(words.join(" "));
                document.getElementById("message").className.add("warning");
                document.getElementById("message").innerText = "Words are copied to clipboard!"
            }
		</script>
	</head>
	<body>
        <h1>Deterministic Mnemonic Generator</h1>
        <div id="message"></div>
        <div id="inputs">
            <div>
                <label class="info">Words Size</label>
                <select name="size" id="size">
                    <option value="24">24</option>
                    <option value="21">21</option>
                    <option value="18">18</option>
                    <option value="15">15</option>
                    <option value="12">12</option>
                </select>
            </div>
            <div>
                <label class="info">Id (Username/Email/Phone/Id)</label>
                <input type="text" name="identifier" id="identifier" />
            </div>
            <div>
                <label class="info">Password (min 12 chars)</label>
                <input type="password" name="password" id="password" />
                <a href="#password" onclick="toggleSingle('password');">Show/Hide</a>
            </div>
            <div>
                <label class="info">Passcode (6 digit number can start with zeros)</label>
                <input type="password" name="passcode" id="passcode" />
                <a href="#passcode" onclick="toggleSingle('passcode');">Show/Hide</a>
            </div>
            <div id="actions">
                <button onclick="generateAndFill();">Generate</button>
                <button onclick="reset();">Reset</button>
                <button onclick="copyWords();" id="copy" hidden="true">Copy words</button>
            </div>
        </div>
        <div id="words"></div>
        <div id="footer">
            <p>Library version: <span id="library_version"></span>, algorithm version: <span id="algorithm_version"></span></p>
            <p>
                <a href="https://github.com/nomnemonic/nomnemonic">Library (Github)</a>
                <a href="https://github.com/nomnemonic/nomnemonic-cli">Cli app (Github)</a>
                <a href="https://github.com/nomnemonic/nomnemonic-wasm">Wasm app (Github)</a>
            </p>
        </div>
    </body>
</html>
